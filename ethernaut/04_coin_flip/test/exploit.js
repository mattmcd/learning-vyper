const CoinFlip = artifacts.require("CoinFlip");
const CoinFlipExploit = artifacts.require("CoinFlipExploit");

contract("Test exploit", async accounts => {
    it("Should guess correctly", async() => {
        let instance = await CoinFlip.deployed();
        let exploit = await CoinFlipExploit.deployed();
        let wins = await instance.consecutiveWins();

        for (let i=0; i<10; i++) {
            let prev_wins = wins;
            await exploit.flip({from: accounts[0]});
            wins = await instance.consecutiveWins();
            console.log(wins.toString());
            assert.equal(wins.toString(), (new web3.utils.BN(prev_wins)).add(new web3.utils.BN('1')).toString());
        }
    })

});
